{% extends 'layouts/base.html' %}

{% block title %} Dashboard {% endblock title %}
{% block content %}

<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>window.token = "{{ token }}"</script>

  <!-- remove below - this is now invoked by clicking "View All" under recommendations -->
  <!-- <script>
    $("#absence_analysis").on('click', function(e){
   
      console.log('getting absence analysis');
  
      $.ajax({
        type: "GET",
        url: '/absence_analysis',
        success: function(resp){
          console.log('done');
          }
      });
  
  
      });
  
  </script> -->

  <!-- after clicking on absence analysis, update default notifications -->
   <!-- NB must be at top of script as reload invoked by clicking "Absences" -->

<script>

  $(document).ready(function (){
  
  
        // document.getElementById("most_absences").innerHTML="Bajaj Finery";
        // $('#most_absences').show();
  
        // change variable names on reload 
        if (performance.navigation.type == performance.navigation.TYPE_RELOAD) {
  
          console.info( "This page is reloaded" );
  
          // client notification
          document.getElementById("most_absences").innerHTML = "{{ session['most_absences'] }}";
          document.getElementById("least_num_last_min_absences").innerHTML = "{{ session['least_num_last_min_absences'] }}";
          document.getElementById("latest_absence_leadtime").innerHTML = "{{ session['latest_absence_leadtime'] }}";
          document.getElementById("earliest_absence_leadtime").innerHTML = "{{ session['earliest_absence_leadtime'] }}";
          document.getElementById("shortest_avg_absence_duration").innerHTML = "{{ session['shortest_avg_absence_duration'] }}";
  
          // labels
          document.getElementById("most_absences_label").innerHTML = "most absences";
          document.getElementById("least_num_last_min_absences_label").innerHTML = "least last minute absences";
          document.getElementById("latest_absence_leadtime_label").innerHTML = "latest absence leadtime";
          document.getElementById("earliest_absence_leadtime_label").innerHTML = "earliest absence leadtime";
          document.getElementById("shortest_avg_absence_duration_label").innerHTML = "shortest average absence duration";
        
          // result
          document.getElementById("most_absences_result").innerHTML = "{{ session['most_absences_result'] }}";
          document.getElementById("least_num_last_min_absences_result").innerHTML =  "{{ session['least_num_last_min_absences_result'] }}";
          document.getElementById("latest_absence_leadtime_result").innerHTML = "{{ session['latest_absence_leadtime_result'] }} days";
          document.getElementById("earliest_absence_leadtime_result").innerHTML = "{{ session['earliest_absence_leadtime_result'] }} days";
          document.getElementById("shortest_avg_absence_duration_result").innerHTML = "{{ session['shortest_avg_absence_duration_result'] }} hours";
  
        }
      
      });
  
    </script>



</head>

  <!-- [ Main Content ] start -->
  <div class="pc-container">
    <div class="pc-content">
      <!-- [ Main Content ] start -->
      <div class="row">
        <!-- [ sample-page ] start -->

        <!-- growth chart block -->
        <div class="col-xl-8 col-md-12" id="forecast_chart" style="display:none;">
          <div class="card">
            <div class="card-body">
              <div class="row mb-3 align-items-center">
                <div class="col">
                  <small>{{ session["realm-site"] }}</small>
                  <h3>{{ session["fcast_sales"] }}</h3>
                </div>
                <div class="col-auto">
                  <select class="form-select p-r-35">
                    <option>Today</option>
                    <option selected>This Month</option>
                    <option>This Year</option>
                  </select>
                </div>
              </div>
              <div id="growthchart"></div>
            </div>
          </div>
        </div>

        <!-- placeholder sales chart block prior to running sales forecast -->
        <div class="col-xl-8 col-md-12" id="placeholder_block" style="display:none;">
          <div class="card" >
            <div class="card-body" id="placeholder-card">
              <div class="row mb-3 align-items-center">
                <div class="col" style="position:relative; width:100%; height:0px; padding-bottom:56.25%;">
                  <iframe class="responsive-iframe" style="position:absolute; left:0; top:0; width:100%; height:100%" 
                    src="https://www.youtube.com/embed/QMKM4d1ly88?si=5cpiyVoZOzrx_CKg">
                  </iframe> <!-- <!-- <!-- original source here: https://t4.ftcdn.net/jpg/02/77/71/45/360_F_277714513_fQ0akmI3TQxa0wkPCLeO12Rx3cL2AuIf.jpg or youtube video placeholder here: https://www.youtube.com/embed/RhlQvbvMg-0?si=9v-o2opHNpy3jYxZ -->
                </div>  
              </div>
            </div>
          </div>
        </div>

        <!-- line chart block -->
        <div class="col-xl-4 col-md-6" id ="earnings_div">
          <div class="card bg-primary-dark dashnum-card text-white overflow-hidden">
            <span class="round small"></span>
            <span class="round big"></span>
            <div class="card-body">
              <div class="row">
                <div class="col">
                  <div class="avtar avtar-lg">
                    <i class="text-white ti ti-credit-card"></i>
                  </div>
                </div>
                <div class="col-auto">
                  <ul class="nav nav-pills justify-content-end mb-0" id="chart-tab-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link text-white active"
                        id="chart-tab-home-tab"
                        data-bs-toggle="pill"
                        data-bs-target="#chart-tab-home"
                        type="button"
                        role="tab"
                        aria-controls="chart-tab-home"
                        aria-selected="true"
                        >Month</button
                      >
                    </li>
                    <li class="nav-item" role="presentation">
                      <button
                        class="nav-link text-white"
                        id="chart-tab-profile-tab"
                        data-bs-toggle="pill"
                        data-bs-target="#chart-tab-profile"
                        type="button"
                        role="tab"
                        aria-controls="chart-tab-profile"
                        aria-selected="false"
                        >Year</button
                      >
                    </li>
                  </ul>
                </div>
              </div>
              <div class="tab-content" id="chart-tab-tabContent">
                <div class="tab-pane show active" id="chart-tab-home" role="tabpanel" aria-labelledby="chart-tab-home-tab" tabindex="0">
                  <div class="row">
                    <div class="col-6">
                      <span class="text-white d-block f-34 f-w-500 my-2">$130<i class="ti ti-arrow-up-right-circle opacity-50"></i></span>
                      <p class="mb-0 opacity-50">Total Earning</p>
                    </div>
                    <div class="col-6">
                      <div id="tab-chart-1"></div>
                    </div>
                  </div>
                </div>
                <div class="tab-pane" id="chart-tab-profile" role="tabpanel" aria-labelledby="chart-tab-profile-tab" tabindex="0">
                  <div class="row">
                    <div class="col-6">
                      <span class="text-white d-block f-34 f-w-500 my-2">$299 <i class="ti ti-arrow-down-right-circle opacity-50"></i></span>
                      <p class="mb-0 opacity-50">C/W Last Year</p>
                    </div>
                    <div class="col-6">
                      <div id="tab-chart-2"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- short KPI cards -->
        <div class="col-xl-4 col-md-12" id ="profit_rev_div">
          <div class="card bg-primary-dark dashnum-card dashnum-card-small text-white overflow-hidden">
            <span class="round bg-primary small"></span>
            <span class="round bg-primary big"></span>
            <div class="card-body p-3">
              <div class="d-flex align-items-center">
                <div class="avtar avtar-lg">
                  <i class="text-white ti ti-credit-card"></i>
                </div>
                <div class="ms-2">
                  <h4 class="text-white mb-1">$203k <i class="ti ti-arrow-up-right-circle opacity-50"></i></h4>
                  <p class="mb-0 opacity-50 text-sm">Net Profit</p> 
                </div>
              </div>
            </div>
          </div>
          <div class="card dashnum-card dashnum-card-small overflow-hidden">
            <span class="round bg-warning small"></span>
            <span class="round bg-warning big"></span>
            <div class="card-body p-3">
              <div class="d-flex align-items-center">
                <div class="avtar avtar-lg bg-light-warning">
                  <i class="text-warning ti ti-credit-card"></i>
                </div>
                <div class="ms-2">
                  <h4 class="mb-1">$550K <i class="ti ti-arrow-up-right-circle opacity-50"></i></h4>
                  <p class="mb-0 opacity-50 text-sm">Total Revenue</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-4 col-md-12" id ="stocks_div">
          <div class="card">
            <div class="card-body">
              <div class="row mb-3 align-items-center">
                <div class="col">
                  <h4>Recommendations</h4>
                </div>
                <div class="col-auto"> </div>
              </div>
              <div class="rounded bg-light-secondary overflow-hidden mb-3">
                <div class="px-3 pt-3">
                  <div class="row mb-1 align-items-start">
                    <div class="col">
                      <h5 class="text-secondary mb-0">Bajaj Finery</h5>
                      <small class="text-muted">10% Profit</small>
                    </div>
                    <div class="col-auto">
                      <h4 class="mb-0">$1839.00</h4>
                    </div>
                  </div>
                </div>
                <div id="bajajchart"></div>
              </div>
              <ul class="list-group list-group-flush">
                <li class="list-group-item px-0">
                  <div class="row align-items-start">
                    <div class="col">
                      <h5 class="mb-0" id="most_absences">rotaready</h5> <!-- Bajaj Finery -->
                      <small class="text-success" id="most_absences_label">10% Profit</small> <!-- 10% Profit -->
                    </div>
                    <div class="col-auto">
                      <h4 class="mb-0" id="most_absences_result">
                        <span class="ms-2 align-top avtar avtar-xxs bg-light-success"
                          ><i class="ti ti-chevron-up text-success"></i></span>
                      ></h4>
                    </div>
                  </div>
                </li>
                <li class="list-group-item px-0">
                  <div class="row align-items-start">
                    <div class="col">
                      <h5 class="mb-0" id="least_num_last_min_absences">S4Labour</h5>
                      <small class="text-danger" id="least_num_last_min_absences_label">15% Loss</small>
                    </div>
                    <div class="col-auto">
                      <h4 class="mb-0" id="least_num_last_min_absences_result">
                        <span class="ms-2 align-top avtar avtar-xxs bg-light-danger"
                          ><i class="ti ti-chevron-down text-danger"></i></span>
                      ></h4>
                    </div>
                  </div>  
                </li>
                <li class="list-group-item px-0">
                  <div class="row align-items-start">
                    <div class="col">
                      <h5 class="mb-0" id="latest_absence_leadtime">Fourth</h5>
                      <small class="text-success" id="latest_absence_leadtime_label">3% Profit</small>
                    </div>
                    <div class="col-auto">
                      <h4 class="mb-0" id="latest_absence_leadtime_result">
                        <span class="ms-2 align-top avtar avtar-xxs bg-light-success"
                          ><i class="ti ti-chevron-up text-success"></i></span>
                      ></h4>
                    </div>
                  </div>
                </li>
                <li class="list-group-item px-0">
                  <div class="row align-items-start">
                    <div class="col">
                      <h5 class="mb-0" id="earliest_absence_leadtime">Deputy</h5>
                      <small class="text-danger" id="earliest_absence_leadtime_label">8% Loss</small>
                    </div>
                    <div class="col-auto">
                      <h4 class="mb-0" id="earliest_absence_leadtime_result">
                        <span class="ms-2 align-top avtar avtar-xxs bg-light-danger"
                          ><i class="ti ti-chevron-down text-danger"></i></span>
                      ></h4>
                    </div>
                  </div>
                </li>
                <li class="list-group-item px-0">
                  <div class="row align-items-start">
                    <div class="col">
                      <h5 class="mb-0" id="shortest_avg_absence_duration">Workforce</h5>
                      <small class="text-danger" id="shortest_avg_absence_duration_label">1% Loss</small>
                    </div>
                    <div class="col-auto">
                      <h4 class="mb-0" id="shortest_avg_absence_duration_result">
                        <span class="ms-2 align-top avtar avtar-xxs bg-light-danger"
                          ><i class="ti ti-chevron-down text-danger"></i></span>
                      ></h4>
                    </div>
                  </div>
                </li>
              </ul>
              <div class="text-center">
                <a href="/absence_analysis" class="b-b-primary text-primary" id="absence_click">Absences <i class="ti ti-chevron-right"></i></a>
              </div>
            </div>
          </div>

        </div>
        <!-- [ sample-page ] end -->


      

  <div class="col-xl-4 col-md-6" id ="orders_div">
    <div class="card bg-secondary-dark dashnum-card text-white overflow-hidden">
      <span class="round small"></span>
      <span class="round big"></span>
      <div class="card-body">
        <div class="row">
          <div class="col">
            <div class="avtar avtar-lg">
              <i class="text-white ti ti-credit-card"></i>
            </div>
          </div>
          <div class="col-auto">
            <div class="btn-group">
              <a
                type="button"
                class="avtar bg-secondary dropdown-toggle arrow-none"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="ti ti-dots"></i>
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><button class="dropdown-item" type="button">Import Card</button></li>
                <li><button class="dropdown-item" type="button">Export</button></li>
              </ul>
            </div>
          </div>
        </div>
        <span class="text-white d-block f-34 f-w-500 my-2">
          <!-- {window.token} previously 1350   -->
          <!-- <div id="fcast_sales">{{ session["fcast_sales"] }}</div> -->
          <!-- *check* below need to refactor in .js with a for loop for each cost stream -->
          <div id="actual_sales_raw" style="display: none;">{{ session["actuals"] }}</div>
          <div id="fcast_vals_raw_1" style="display: none;">{{ session["fcast_vals_raw_1"] }}</div>
          <div id="fcast_vals_raw_2" style="display: none;">{{ session["fcast_vals_raw_2"] }}</div>
          <div id="fcast_vals_raw_3" style="display: none;">{{ session["fcast_vals_raw_3"] }}</div>
          <div id="fcast_vals_raw_4" style="display: none;">{{ session["fcast_vals_raw_4"] }}</div>
          <div id="fcast_vals_raw_5" style="display: none;">{{ session["fcast_vals_raw_5"] }}</div>
          <div id="fcast_vals_raw_6" style="display: none;">{{ session["fcast_vals_raw_6"] }}</div>
          <div id="fcast_dates" style="display: none;">{{ session["fcast_dates"] }}</div>
          <!-- {{ session["output"] }} AND
          {{ session["fcast_sales"] }} -->
          <!-- <p id="homeMsg" style="display:none;">{window.token} previously 1350</p> -->
            <!-- <script>localStorage.getItem("sfcast")</script> -->
          <i class="ti ti-arrow-up-right-circle opacity-50"></i>
        </span>
        <p class="mb-0 opacity-50">Forecast Prediction Here (previously: Total Pending Orders)</p>
      </div>
    </div>
  </div>

</div>
<!-- [ Main Content ] end -->
</div>
</div>
<!-- [ Main Content ] end -->

<script> 

      // var ac = document.getElementById("absence_click")
      // ac.onclick = reloadWindow;


      // function reloadWindow() {
      //   console.log('getting absence analysis');
      //   window.location.reload();
      //   return false;
      // }


      var ac = document.getElementById('absence_click');
      ac.onclick = get_absences_reload_screen;


    function get_absences_reload_screen() {

          $.ajax({
                  type: "GET",
                  url: '/absence_analysis',
                              success: function (resp) {
                                    // remove message and reload page after graceful 10 secs
                                    setTimeout(function(){
                                        window.location.reload();
                                    }, 1000);
                                  },
                                  error: function (error) {
                                    console.log(error);
                                  }
                                })
        
      return false;
    }

</script>     

{% endblock content %}

{% block extra_js %}
  <!-- Apex Chart -->
  <script src="{{ url_for('static', filename='assets/js/plugins/apexcharts.min.js') }}"></script>
  <script src="{{ url_for('static', filename='assets/js/pages/dashboard-default.js') }}"></script>

  

  <!-- [Page Specific JS] end -->
{% endblock extra_js %}
